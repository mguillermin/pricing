#{extends 'main.html' /}
#{set title:pricing.title /}

<h1>${pricing.code} - ${pricing.title}</h1>

#{if flash.success}
	<p class="success">${flash.success}</p>
#{/if}

#{set profileCount:pricing.profiles.size() /}
<table class="pricing">
  <tr>
  	<th class="title" rowspan="2">Title</th>
  	#{list items:pricing.profiles, as:'profile'}
  		<th class="profile">${profile.title}</th>
  	#{/list}
  	<th class="total" rowspan="2">Total</th>
  </tr>
  <tr>
  	#{list items:pricing.profiles, as:'profile'}
  		<th class="rate">${profile.rate.format('# ###.##')} &euro;</th>
  	#{/list}
  </tr>
  #{if pricing.sections && pricing.sections.size() >= 1}
    #{list items:pricing.sections, as:'section'}
    	<tr class="section">
    	  <td>
          ${section.title}
          <ul class="actions">
            <li><a href="@{Pricings.editLine(section.id)}" class="insert" title="Insert a line"></a></li>
            <li><a href="@{Pricings.editSection(pricing.id, section.id)}" class="edit" title="Edit this section"></a></li>
            <li><a href="@{Pricings.deleteSection(section.id)}" class="delete" title="Delete this section"></a></li>
            <li><a href="@{Pricings.sectionUp(section.id)}" class="up" title="Up"></a></li>
            <li><a href="@{Pricings.sectionDown(section.id)}" class="down" title="Down"></a></li>
          </ul>
        </td>
        #{list items:pricing.profiles, as:'profile'}
  		<td class="profile">${section.getAmountByProfile(profile).format('#.##')}</td>
        #{/list}
  	  <td class="total">${section.getPrice().format('# ###.##')} &euro;</td>
    	</tr>
    	#{list items:section.lines, as:'line'}
    	  <tr class="line">
    	  	<td>
            ${line.title}
            <ul class="actions">
              <li><a href="@{Pricings.editLine(section.id, line.id)}" class="edit" title="Edit"></a></li>
              <li><a href="@{Pricings.deleteLine(line.id)}" class="delete" title="Delete"></a></li>
              <li><a href="@{Pricings.lineUp(line.id)}" class="up" title="Up"></a></li>
              <li><a href="@{Pricings.lineDown(line.id)}" class="down" title="Down"></a></li>
            </ul>
          </td>
  		#{list items:pricing.profiles, as:'profile'}
  		  #{set detail:line.getDetailByProfile(profile) /}
  		  <td class="profile">
  		  #{if detail}
  			${detail.amount.format('#.##')}
  	      #{/if}
  	      #{else}
  	      	0
  	      #{/else}
  	      </td>
  		#{/list}
  		<td class="total">${line.getPrice().format('# ###.##')} &euro;</td>
    	  </tr>
    	#{/list}
    #{/list}
  #{/if}
  <tr class="total">
    <td>Total</td>
    #{list items:pricing.profiles, as:'profile'}
      <td class="profile">${pricing.getAmountByProfile(profile).format('#.##')}</td>
    #{/list}
    <td class="total">${pricing.getPrice().format('# ###.##')} &euro;</td>
  </tr>
</table>

<a href="@{Pricings.editSection(pricing.id)}" class="add">Add a section</a>
<a href="javascript:void(0)" class="edit" id="toggle-edition">Toggle edition controls</a>